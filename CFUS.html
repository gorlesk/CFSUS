<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>

.axisBlue text{
  fill: skyblue;
} 

.axisBlue line{
  stroke: skyblue;
}

.axisBlue path{
  stroke: skyblue;
}

div.tooltip {
  position: absolute;
  text-align: center;
  width: 130px;
  height: 60px;
  padding: 2px;
  font: 14px sans-serif;
  background: skyblue;
  border: 0px;
  border-radius: 8px;
}

</style>
<body onload='init()'>
<svg width=900 height=900>
</svg>
<script>
//d3.select('svg').attr("fill", "pink");
//d3.select('svg').style("background-color", 'black');
//d3.select('svg').style("background-color", 'skyblue');

async function init() {
	var margin = 50;
	var height = 800;
	const data = await d3.csv('https://raw.githubusercontent.com/gorlesk/CFSUS/master/Covid19_Financial_Impact_US.csv');
var width = 900;
var WIDTH = 900;
var HEIGHT = 900;
//var margin = 50;
var margin = {top: 20, right: 20, bottom: 50, left: 70};
var MARGIN = {top: 50, right: 50, bottom: 20, left: 50};

d3.select("svg")
.style("background-color", "black");

const INNER_WIDTH  = WIDTH - MARGIN.left - MARGIN.right;
const INNER_HEIGHT = HEIGHT - MARGIN.top - MARGIN.bottom;


var xScale = d3.scaleLog()
      .domain([5,60000])
      .range([0, 800])
      .base(10);

var yScale = d3.scaleLog()
       .domain([700000,400000000])
       .range([800,0])
       .base(10);


var rScale= d3.scaleSqrt();
rScale.domain([104,338961]).range([1, 16]);
/*var tooltip = d3.select('svg')
.append('div')
.attr('class', 'tooltip')
.style("opacity", 0);*/

var div = d3.select("body").append("div")
.attr("class", "tooltip")
.style("opacity", 0);

var myFormat=d3.timeFormat("~s");
var p = d3.precisionPrefix(1e5, 1.3e6);

d3.select('svg').append("g")
.attr("transform","translate(50,50)")
.selectAll('circle').data(data)
.enter().append('circle')
.attr("cx", function(d) {return xScale(d.Deaths) ;})	
.attr("cy", function(d) {return yScale(d.Debt) ;})
.attr("r",function(d)    {return  rScale(d.Active);})
.style("fill","skyblue")
.style("stroke", "white")
.style("stroke-width", 2)
.on('click', function(d){console.log(d.Province_State);
//CovidDeathActive.html d.Province_State
window.location.replace("CovidDeathActive.html?Province_State="+d.Province_State);

})
.on("mouseover", function(d) {
	   debt = myFormat(d.Debt);
       div.transition()
         .duration(50)
         .style("opacity", .9);
       div.html(
         "<b>"+d.Province_State+ "</b>" + "<br/>" + "Debt: " + d3.formatPrefix("." + p, 1.3e6)(d.Debt) + " $" +"<br/>"+ "Deaths: " + d.Deaths)    
         .style("left", (d3.event.pageX+10) + "px")             
         .style("top", (d3.event.pageY - 15) + "px");
       })
.on('mouseout', () => {
div
.transition()
.duration(50)
.style('opacity', 1);
});



// text label for the x axis
d3.select('svg').append("text")             
    .attr("transform",
          "translate(" + (width/2) + " ," + 
                         (height + 90) + ")")
.text("Covid Deaths")
.style('font-size', '17px')
.style('font-family', '"Open Sans", sans-serif')
.style('font-weight', 'bold').style("fill","skyblue");
    

//text label for the y axis
d3.select('svg').append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 0)
    .attr("x",0 - (height / 2) - 50)
    .attr("dy", "1em")
.text("Debt  in  $")     
.style('font-size', '17px')
.style('font-family', '"Open Sans", sans-serif')
.style('font-weight', 'bold').style("fill","skyblue");


//d3.select('svg').append("g").attr("transform","translate(50,50)").selectAll('circle').data(data)
//.enter().append("text")
//.attr("dx", function(d){return xScale(d.Deaths);})
//.attr("dy", function(d) {return yScale(d.Debt-10) ;})
//.text(function(d) {return d.Province_State;})

var xTickValues = [10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 10000, 20000, 50000]
var yTickValues = [1000000, 2000000, 5000000, 10000000, 20000000, 50000000, 100000000, 200000000]

const xAxisGrid = d3.axisBottom(xScale).tickSize(-1000).tickFormat('').ticks(4);
const yAxisGrid = d3.axisLeft(yScale).tickSize(-1000).tickFormat('').ticks(2);


//Create grids.
//d3.select('svg').append('g')
//  .attr("transform","translate("+margin.bottom+","+margin.bottom+")")
//  .call(yAxisGrid);

//d3.select('svg').append('g').attr("transform","translate("+margin.bottom+","+(height+margin.bottom)+")")
//  .call(xAxisGrid);



var y_axis = d3.axisLeft().scale(yScale).tickValues(yTickValues).tickFormat(d3.format("~s"));

d3.select("svg")
   .append("g")
   .attr("transform","translate("+margin.bottom+","+margin.bottom+")")
   .call(y_axis).attr("class", "axisBlue");
     
var x_axis = d3.axisBottom().scale(xScale).tickValues(xTickValues).tickFormat(d3.format("~s"));
d3.select("svg")
   .append("g")
   .attr("transform","translate("+margin.bottom+","+(height+margin.bottom)+")")
   .call(x_axis).attr("class", "axisBlue");

}
</script>
</body>
</html>