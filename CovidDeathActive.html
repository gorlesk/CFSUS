<html>
<head>
 <meta charset = "UTF-8">
 <title>externalStyle.html</title>
 <link rel = "stylesheet"
   type = "text/css"
   href = "index.css" />

<script src='https://d3js.org/d3.v5.min.js'></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<script>

</script>
 </head>
 
<body onload='init()'>

<div class="text1">
  <h3>Overview of Covid deaths vs Debt in USA</h3>
</div>

<div class="rightnext">
		<input id ="b1" type="button" onclick="NextPage();" style="float:right" class="button" value=" Continue ">
		<div class="content">
		<p class="text1">
		Whole layout described with a  Scatter plot to have gist of Covid financial impact in USA and two Bar 
		charts to dig into the details by Covid-19 cases and financial details respectively.
	
	First, Scatter plot chart on the left, gives overview of all states representing Covid deaths occurred 
	against debt of a state. Position on a circle indicates how the state is effected by Covid deaths against 
	debt of a state. Which implies that one on the top right extreme has impacted by Covid badly.In addition, 
	the size of the circle resembles active Covid cases of given state. Which means, the larger the size represent 
	more number of active cases and smaller the circle size indicates lesser no of active cases in a state.
	Secondly, The Bar chart on the top right provides specific information about a state Covid cases information 
	with "Deaths", "Confirmed" and "Active" numbers and can be easily compared with other states. 
	The right bottom Bar chart shows state specific details about economical position a state with "State and Local Debt%", 
	"Real State Growth %"  and "Gross State Product". Bar chats with size, unique color per category with values
	 helps to compare each state with others
		
		</p>
		</div>
</div>	
	
<svg width=900 height=330>
</svg>
<script>

/**/


console.log(">> ");
const queryString = window.location.search;
console.log(queryString);

const urlParams = new URLSearchParams(queryString);
console.log(urlParams);

var state = urlParams.get('Province_State')
console.log("script"+state);

function NextPage() {
	
    var my_url = "FinancialOnly.html?Province_State="+state;
	console.log("my_url "+my_url);
    
	window.top.location.href=my_url; 
}
async function init() {
	var margin = 50;
	var height = 400;
	const data = await d3.csv('https://raw.githubusercontent.com/gorlesk/CFSUS/master/Covid19_Financial_Impact_US.csv');
var width = 800;
var WIDTH = 900;
var HEIGHT = 900;
//var margin = 50;
var margin = {top: 20, right: 20, bottom: 50, left: 70};
var MARGIN = {top: 50, right: 50, bottom: 20, left: 50};

d3.select("svg").style("background-color", "black");

const INNER_WIDTH  = WIDTH - MARGIN.left - MARGIN.right;
const INNER_HEIGHT = HEIGHT - MARGIN.top - MARGIN.bottom;


var xScale = d3.scaleLog()
      .domain([200,413175])
      .range([0, 800])
      .base(10);

var yScale = d3.scaleLog()
       .domain([5,35000])
       .range([250,0])
       .base(10);


var rScale= d3.scaleSqrt();
rScale.domain([104,338961]).range([1, 20]);

var div = d3.select("body").append("div")
.attr("class", "tooltip")
.style("opacity", 0);

var myFormat=d3.timeFormat("~s");
var p = d3.precisionPrefix(1e3, 1.3e4);


var canvas = d3.select('svg').append("g")
.attr("transform","translate(50,50)")
.attr("background-color", 'black');

canvas.selectAll('circle').data(data)
.enter().append('circle').attr("cy", function(d) {return yScale(d.Deaths) ;})
.attr("cx", function(d) {return xScale(d.Confirmed) ;})	
.attr("r",function(d)    {return  rScale(d.Active);})
.style("fill","black").style("stroke-width", 2)
.style("stroke", "white")
.on("mouseover", function(d) {
	   debt = myFormat(d.Debt);
       div.transition()
         .duration(50)
         .style("opacity", .9);
       div.html(
         //"<b>"+d.Province_State+ "</b>" + "<br/>" + "Confirmed: " + d3.formatPrefix("." + p, 1.3e5)(d.Confirmed)+ "<br/>"+ "Active: " + d3.formatPrefix("." + p, 1.3e5)(d.Active) +"<br/>"+ "Deaths: " +d3.formatPrefix("." + p, 1.3e5) (d.Deaths))    
         "<b>"+d.Province_State+ "</b>" + "<br/>" + "Confirmed: " + (d.Confirmed)+ "<br/>"+ "Active: " +(d.Active) +"<br/>"+ "Deaths: " +(d.Deaths))    
         .style("left", (d3.event.pageX+10) + "px")             
         .style("top", (d3.event.pageY - 15) + "px");
       })
.on('mouseout', () => {
div
.transition()
.duration(50)
.style('opacity', 1);
});

console.log("94"+state);

d3.select('svg').append("g")
.attr("transform","translate(50,50)").attr("background-color", 'black')
.selectAll('circle').data(data)
.enter().append('circle')
.attr("cy", function(d) { 
    if (d.Province_State == state) {return yScale(d.Deaths)};})
.attr("cx", function(d) {    if (d.Province_State == state) {return xScale(d.Confirmed)};})
.attr("r",function(d)    {if (d.Province_State == state) return  rScale(d.Active);})
//.style("fill","skyblue")
.style("fill", function(d) {
      if (d.Province_State == state) {return "skyblue"}
      ;})
//.style("stroke", "white")
.style("stroke", function(d) {
      if (d.Province_State == state) {console.log("red"+state); return "red"}
      ;})
.style("stroke-width", 2)
/*.on('click',function(d)  {
    if(d.Province_State == state)
    {   console.log("nextPage"+state);
        var my_url="CovidPerDayDeaths.html?Province_State="+d.Province_State;
        //window.location.href="CovidPerDayDeaths.html?Province_State="+d.Province_State;
        
        window.top.location.href=my_url;
        //window.parent.location.href=my_url;
    }
})*/
.on("mouseover", function(d) {
	   debt = myFormat(d.Debt);
       div.transition()
         .duration(50)
         .style("opacity", .9);
       div.html(
         //"<b>"+d.Province_State+ "</b>" + "<br/>" + "Confirmed: " + d3.formatPrefix("." + p, 1.3e5)(d.Confirmed)+ "<br/>"+ "Active: " + d3.formatPrefix("." + p, 1.3e5)(d.Active) +"<br/>"+ "Deaths: " +d3.formatPrefix("." + p, 1.3e5) (d.Deaths))    
         "<b>"+d.Province_State+ "</b>" + "<br/>" + "Confirmed: " + (d.Confirmed)+ "<br/>"+ "Active: " +(d.Active) +"<br/>"+ "Deaths: " +(d.Deaths))    
         .style("left", (d3.event.pageX+10) + "px")             
         .style("top", (d3.event.pageY - 15) + "px");
       })
.on('mouseout', () => {
div
.transition()
.duration(50)
.style('opacity', 1);
})
; 

// text label for the x axis
d3.select('svg').append("text")             
    .attr("transform",
          "translate(" + (width/2) + " ," + 
                         (320) + ")")
.text("Covid Confirmed")
.style('font-size', '17px')
.style('font-family', '"Open Sans", sans-serif')
.style('font-weight', 'bold').style("fill","skyblue");
    

//text label for the y axis
d3.select('svg').append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 0)
    .attr("x",0 - (height / 2)-25)
    .attr("dy", "1em")
.text("Covid Deaths")     
.style('font-size', '17px')
.style('font-family', '"Open Sans", sans-serif')
.style('font-weight', 'bold').style("fill","skyblue");


var xTickValues = [200, 2500, 25000, 250000];
var yTickValues = [5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 10000, 20000, 35000];

const xAxisGrid = d3.axisBottom(xScale).tickSize(-1000).tickFormat('').ticks(4);
const yAxisGrid = d3.axisLeft(yScale).tickSize(-1000).tickFormat('').ticks(2);


var y_axis = d3.axisLeft().scale(yScale).tickValues(yTickValues).tickFormat(d3.format("~s"));

d3.select("svg")
   .append("g")
   .attr("transform","translate("+margin.bottom+","+margin.bottom+")")
   .call(y_axis).style("stroke", "skyblue").attr("class", "axisBlue");
     
var x_axis = d3.axisBottom().scale(xScale).tickValues(xTickValues).tickFormat(d3.format("~s"));
d3.select("svg")
   .append("g")
   .attr("transform","translate("+margin.bottom+","+(300)+")")
   .call(x_axis).style("stroke", "skyblue").attr("class", "axisBlue");

}
</script>
</body>
</html>